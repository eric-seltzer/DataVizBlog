{
  "hash": "3904e0ba8dfecd1a720c0193fe31a298",
  "result": {
    "markdown": "---\ntitle: \"Predicting if a NBA Team Will Make the Playoffs\"\nauthor: \"Eric Seltzer\"\ndate: \"2024-03-06\"\ncategories: [sports, code, analysis, data wrangling]\n---\n\n# Intoduction\nFor this blog post, I wanted to take on more of a challenging idea which was to both create a prediction model and visualize that data. To to this, I also wanted to combine this with my passion for sports, particularly basketball. It felt only right to use NBA data to accomplish this. On Data World, I found a data set that had team stats from the 97-98 season all the way until the 21-22 season.\n\n::: {.cell}\n\n```{.r .cell-code}\n# loading in necessary packages\nlibrary(tidyverse)\nlibrary(here)\nlibrary(kableExtra)\nlibrary(broom)\nlibrary(modelr)\nlibrary(knitr)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# loading in data set\nteam_stats <- read_csv(here('data/NBA_Team_Stats.csv'))\n```\n:::\n\nHere is an example of what the data set looks like directly from the source.\n\n# Original Data Set\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(head(team_stats))\n```\n\n::: {.cell-output-display}\n| No|Team        |   G|  Min|   Pts|  Reb|  Ast| Stl| Blk|   To|   Pf| Dreb| Oreb|Fgm-a     | Pct...15|3gm-a    | Pct...17|Ftm-a     | Pct...19|   Eff| Deff|Year      |\n|--:|:-----------|---:|----:|-----:|----:|----:|---:|---:|----:|----:|----:|----:|:---------|--------:|:--------|--------:|:---------|--------:|-----:|----:|:---------|\n|  1|Chicago     | 103| 48.4|  96.0| 44.1| 23.1| 8.6| 4.3| 13.0| 21.1| 29.2| 14.9|36.7-81.7 |    0.449|3.9-12.0 |    0.323|18.7-25.2 |    0.741| 111.6| 17.5|1997-1998 |\n|  2|Utah        | 102| 48.3|  98.6| 40.8| 24.7| 7.6| 4.8| 14.7| 24.3| 29.5| 11.3|35.9-74.3 |    0.483|3.1-8.4  |    0.368|23.8-30.9 |    0.768| 116.3| 17.5|1997-1998 |\n|  3|Phoenix     |  86| 48.6|  99.3| 41.9| 25.6| 9.2| 5.3| 14.4| 21.7| 29.8| 12.1|38.2-82.0 |    0.466|5.2-14.7 |    0.355|17.7-23.6 |    0.747| 117.1| 13.6|1997-1998 |\n|  4|L.A.Lakers  |  95| 48.3| 104.8| 42.9| 24.3| 8.7| 6.8| 14.7| 22.9| 29.7| 13.2|38.0-79.1 |    0.480|6.1-17.3 |    0.350|22.8-33.7 |    0.675| 120.8| 13.2|1997-1998 |\n|  5|San Antonio |  91| 48.4|  92.5| 44.1| 21.9| 6.2| 6.9| 15.3| 21.2| 32.2| 11.9|35.1-75.1 |    0.468|3.7-10.8 |    0.344|18.5-26.8 |    0.688| 108.0| 13.1|1997-1998 |\n|  6|Indiana     |  98| 48.4|  95.3| 38.6| 22.4| 7.8| 4.5| 13.6| 23.0| 28.2| 10.4|35.0-74.9 |    0.468|5.0-12.9 |    0.387|20.3-26.6 |    0.763| 109.0| 12.2|1997-1998 |\n:::\n:::\n\n\nMy first step in this project is to clean and format this data in a way so that I can work with it how I want too. Below is a table showing what all the variable names mean.\n\n# Variable Explanations\n| Variable | Description                                                                |\n|----------|----------------------------------------------------------------------------|\n| No       | End of Season Ranking (1 winning the Finals)                               |\n| Team     | NBA Team Name                                                              |\n| G        | Games Played                                                               |\n| Min      | Average Minutes Per Game                                                   |\n| Pts      | Average Points Per Game                                                    |\n| Reb      | Average Rebounds Per Game                                                  |\n| Ast      | Average Assists Per Game                                                   |\n| Stl      | Average Steals Per Game                                                    |\n| Blk      | Average Blocks Per Game                                                    |\n| To       | Average Turnovers Per Game                                                 |\n| Pf       | Average Fouls Per Game                                                     |\n| Dreb     | Average Defensive Rebounds Per Game                                        |\n| Oreb     | Average Offensive Rebounds Per Game                                        |\n| Fgm-a    | Average Field Goals Made Per Game - Average Field Goals Attempted Per Game |\n| 3gm-a    | Average 3 Pointers Made Per Game - Average 3 Pointers Attempted Per Game   |\n| Ftm-a    | Average Free Throws Made Per Game - Average Free Throws Attempted Per Game |\n| Eff      | NBA Efficiency Recap                                                       |\n| Deff     | Efficiency Recap Difference                                                |\n| Year     | Year of the NBA Season                                                     |\n\n\n# Data Cleaning\n\n::: {.cell}\n\n```{.r .cell-code}\nteam_stats_tidy <-\n  team_stats |>\n  mutate(Team = factor(Team))\nteam_stats_tidy <-\n  team_stats_tidy |>\n  mutate(Team = fct_recode(Team,\n                           Bulls = \"Chicago\",\n                           Jazz = \"Utah\",\n                           Suns = \"Phoenix\",\n                           Lakers = \"L.A.Lakers\",\n                           Spurs = \"San Antonio\",\n                           Pacers = \"Indiana\", \n                           Heat = \"Miami\",\n                           Thunder = \"Seattle\", \n                           Hawks = \"Atlanta\", \n                           Knicks = \"New York\",\n                           Cavaliers = \"Cleveland\",\n                           Hornets = \"Charlotte\",\n                           Trailblazers = \"Portland\", \n                           Timberwolves = \"Minnesota\",\n                           Wizards = \"Washington\",\n                           Pistons = \"Detroit\",\n                           Nets = \"New Jersey\",\n                           Bucks = \"Milwaukee\",\n                           Magic = \"Orlando\",\n                           Rockets = \"Houston\",\n                           Celtics = \"Boston\",\n                           `76ers` = \"Philadelphia\",\n                           Kings = \"Sacramento\",\n                           Mavericks = \"Dallas\",\n                           Grizzlies = \"Vancouver\",\n                           Clippers = \"L.A.Clippers\",\n                           Warriors = \"Golden State\",\n                           Raptors = \"Toronto\",\n                           Nuggets = \"Denver\",\n                           Pelicans = \"New Orleans\",\n                           Grizzlies = \"Memphis\",\n                           Nets = \"Brooklyn\",\n                           Thunder = \"Oklahoma City\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nteam_stats_tidy <-\n  team_stats_tidy |>\n  separate(`Fgm-a`,\n           sep = \"-\",\n           into = c(\"FGM\", \"FGA\")) |>\n  separate(`3gm-a`,\n           sep = \"-\",\n           into = c(\"3PM\", \"3PA\")) |>\n  separate(`Ftm-a`,\n           sep = \"-\",\n           into = c(\"FTM\", \"FTA\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nteam_stats_tidy <-\n  team_stats_tidy |>\n  rename(FG_pct = Pct...15,\n         `3P_pct` = Pct...17,\n         FT_pct = Pct...19) |>\n  mutate(FGM = as.numeric(FGM),\n         FGA = as.numeric(FGA),\n         `3PM` = as.numeric(`3PM`),\n         `3PA` = as.numeric(`3PA`),\n         FTM = as.numeric(FTM),\n         FTA = as.numeric(FTA),\n         FG_pct = FG_pct * 100,\n         `3P_pct` = `3P_pct` * 100,\n         FT_pct = FT_pct * 100) |>\n  mutate(Year = str_sub(Year,\n                        6),\n         Year = as.numeric(Year))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nteam_stats_tidy <-\n  team_stats_tidy |>\n  mutate(Conference = if_else(Team %in% c(\"Celtics\", \"Bucks\", \"Cavaliers\", \"Knicks\", \"76ers\", \"Magic\", \"Heat\", \"Pacers\", \"Bulls\", \"Hawks\", \"Nets\", \"Raptors\", \"Hornets\", \"Wizards\", \"Pistons\"), \"East\", \"West\"),\n         Playoffs = if_else(G > 82, 1, 0)) |>\n  mutate(over100 = factor(if_else(Pts >= 100, \"Yes\", \"No\")))\n```\n:::\n\n\n# Cleaned Data Set\nHere is an example of what the data now looks like\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(head(team_stats_tidy))\n```\n\n::: {.cell-output-display}\n| No|Team   |   G|  Min|   Pts|  Reb|  Ast| Stl| Blk|   To|   Pf| Dreb| Oreb|  FGM|  FGA| FG_pct| 3PM|  3PA| 3P_pct|  FTM|  FTA| FT_pct|   Eff| Deff| Year|Conference | Playoffs|over100 |\n|--:|:------|---:|----:|-----:|----:|----:|---:|---:|----:|----:|----:|----:|----:|----:|------:|---:|----:|------:|----:|----:|------:|-----:|----:|----:|:----------|--------:|:-------|\n|  1|Bulls  | 103| 48.4|  96.0| 44.1| 23.1| 8.6| 4.3| 13.0| 21.1| 29.2| 14.9| 36.7| 81.7|   44.9| 3.9| 12.0|   32.3| 18.7| 25.2|   74.1| 111.6| 17.5| 1998|East       |        1|No      |\n|  2|Jazz   | 102| 48.3|  98.6| 40.8| 24.7| 7.6| 4.8| 14.7| 24.3| 29.5| 11.3| 35.9| 74.3|   48.3| 3.1|  8.4|   36.8| 23.8| 30.9|   76.8| 116.3| 17.5| 1998|West       |        1|No      |\n|  3|Suns   |  86| 48.6|  99.3| 41.9| 25.6| 9.2| 5.3| 14.4| 21.7| 29.8| 12.1| 38.2| 82.0|   46.6| 5.2| 14.7|   35.5| 17.7| 23.6|   74.7| 117.1| 13.6| 1998|West       |        1|No      |\n|  4|Lakers |  95| 48.3| 104.8| 42.9| 24.3| 8.7| 6.8| 14.7| 22.9| 29.7| 13.2| 38.0| 79.1|   48.0| 6.1| 17.3|   35.0| 22.8| 33.7|   67.5| 120.8| 13.2| 1998|West       |        1|Yes     |\n|  5|Spurs  |  91| 48.4|  92.5| 44.1| 21.9| 6.2| 6.9| 15.3| 21.2| 32.2| 11.9| 35.1| 75.1|   46.8| 3.7| 10.8|   34.4| 18.5| 26.8|   68.8| 108.0| 13.1| 1998|West       |        1|No      |\n|  6|Pacers |  98| 48.4|  95.3| 38.6| 22.4| 7.8| 4.5| 13.6| 23.0| 28.2| 10.4| 35.0| 74.9|   46.8| 5.0| 12.9|   38.7| 20.3| 26.6|   76.3| 109.0| 12.2| 1998|East       |        1|No      |\n:::\n:::\n\n\n# Building a model\nI decided to use some of the metrics in the data set to predict whether a team would make the playoffs or not. I made a response variables Playoffs by using a condition of if a team played more than 82 games or not in season.\n\nIn order to make sure that this model isn't testing using data that knows the answer, we should get rid of both of the No and G variables. We also don't care about what team it is so we should get rid of the team factor.\n\n::: {.cell}\n\n```{.r .cell-code}\nteam_stats_tidy <-\n  team_stats_tidy |>\n  select(-(c(\"No\",\"G\", \"Team\")))\n```\n:::\n\n\nAs this is a blog for data visualization, I am only going to choose three predictors that were all found to be relatively significant in a model using all the predictors. One of these is qualitative to demonstrate more visualization. The predictors are Deff, Conference, and FG_pct. Shown below is my model with their coefficients and p values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplayoffs_mod <- glm(Playoffs ~ Deff + Conference + FG_pct,\n                    data = team_stats_tidy,\n                    family = 'binomial')\nkable(tidy(playoffs_mod))\n```\n\n::: {.cell-output-display}\n|term           |   estimate| std.error|  statistic|   p.value|\n|:--------------|----------:|---------:|----------:|---------:|\n|(Intercept)    |  0.4539997| 3.7403799|  0.1213780| 0.9033917|\n|Deff           |  0.2665841| 0.0209194| 12.7433723| 0.0000000|\n|ConferenceWest | -0.7424358| 0.2228549| -3.3314764| 0.0008639|\n|FG_pct         | -0.0040242| 0.0831379| -0.0484033| 0.9613948|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngrid <-\n  team_stats_tidy |>\n  data_grid(\n    Deff = seq_range(Deff, n = 60),\n    FG_pct = median(FG_pct),\n    Conference = c(\"West\", \"East\"),\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\naug_stats <-\n  augment(playoffs_mod,\n          newdata = grid,\n          se_fit = TRUE)\naug_stats\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 120 × 5\n    Deff FG_pct Conference .fitted .se.fit\n   <dbl>  <dbl> <chr>        <dbl>   <dbl>\n 1 -26     45.2 East         -6.66   0.548\n 2 -26     45.2 West         -7.40   0.599\n 3 -25.0   45.2 East         -6.40   0.529\n 4 -25.0   45.2 West         -7.14   0.579\n 5 -24.0   45.2 East         -6.13   0.509\n 6 -24.0   45.2 West         -6.88   0.559\n 7 -23.0   45.2 East         -5.87   0.489\n 8 -23.0   45.2 West         -6.61   0.539\n 9 -22.1   45.2 East         -5.61   0.470\n10 -22.1   45.2 West         -6.35   0.520\n# ℹ 110 more rows\n```\n:::\n:::\n\n\nNext I need to convert the .fitted values to predicted probabilities. Currently they are showing the predicted log odds.\n\n::: {.cell}\n\n```{.r .cell-code}\naug_stats <-\n  aug_stats |>\n  mutate(.predprob = (exp(.fitted) / (1 + exp(.fitted))))\naug_stats\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 120 × 6\n    Deff FG_pct Conference .fitted .se.fit .predprob\n   <dbl>  <dbl> <chr>        <dbl>   <dbl>     <dbl>\n 1 -26     45.2 East         -6.66   0.548  0.00128 \n 2 -26     45.2 West         -7.40   0.599  0.000610\n 3 -25.0   45.2 East         -6.40   0.529  0.00166 \n 4 -25.0   45.2 West         -7.14   0.579  0.000793\n 5 -24.0   45.2 East         -6.13   0.509  0.00216 \n 6 -24.0   45.2 West         -6.88   0.559  0.00103 \n 7 -23.0   45.2 East         -5.87   0.489  0.00281 \n 8 -23.0   45.2 West         -6.61   0.539  0.00134 \n 9 -22.1   45.2 East         -5.61   0.470  0.00365 \n10 -22.1   45.2 West         -6.35   0.520  0.00174 \n# ℹ 110 more rows\n```\n:::\n:::\n\n\nFor my visualization I plan on using the geom_rug feature, so I need to make two separate data frames with teams that made the playoffs and teams that didn't.\n\n::: {.cell}\n\n```{.r .cell-code}\nstats_playoffs <-\n  team_stats_tidy |>\n  filter(Playoffs == 1)\n\nstats_nplayoffs <-\n  team_stats_tidy |>\n  filter(Playoffs == 0)\n```\n:::\n\n\n# Figure 1\n\n::: {.cell}\n\n```{.r .cell-code}\n#|fig-width: 12\naug_stats|>\n  ggplot(aes(x = Deff,\n             y = .predprob)) +\n  geom_line(aes(colour = Conference),\n            linewidth = 1.2,\n            alpha = 0.8) +\n  scale_colour_viridis_d() +\n  geom_rug(data = stats_playoffs,\n           sides = 't',\n           alpha = 0.3,\n           aes(y = Playoffs)) +\n  geom_rug(data = stats_nplayoffs,\n           sides = 'b',\n           alpha = 0.3,\n           aes(y = Playoffs)) +\n  labs(x = \"Efficiency Recap Rating\",\n       y = \"Predicted Probability\",\n       colour = \"Conference\",\n       title = \"Probability of an NBA Team to Make the Playoffs\",\n       caption = \"(based on data from NBA via data world from 1998 - 2022)\") +\n  theme_minimal() +\n    theme(axis.title = element_text(size = 10,),\n        strip.text = element_text(size = 12),\n        plot.title = element_text(size = 16,\n                                  hjust = 0),\n        plot.subtitle = element_text(size = 6),\n        panel.spacing = unit(1, 'lines'),\n        strip.text.x = element_text(color = \"black\", \n                                    face = \"bold\"),\n        strip.background = element_rect(colour = \"black\",\n                                        fill = \"ivory\"),\n        panel.background = element_rect(fill = \"ivory\"),\n        plot.background = element_rect(fill = \"ivory\"),\n        plot.caption = element_text(hjust = 1.5)) +\n  scale_x_continuous(breaks=seq(-30, 40, 10))\n```\n\n::: {.cell-output-display}\n![](blog-post-3_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n# Conclusion\nThis plot shows the differences in the probability of a team to make the playoffs dependent on their efficiency recap rating, their median field goal percentage, and their conference. What we can see here is that for a team in the Eastern Conference, they need a lower efficiency recap rating to have an over .5 probability of making the playoffs. This can imply that typically over all the seasons this data has been collected, it is easier to make the playoffs in the Eastern Conference.\n\n# Connections to Class\nIn this blog, I used many tactics from class. One being the data visualization aspects of using faceting, and grouping. I put the geom_rug on as well and am visualizing my predicted probabilities for each observation. I also used our technique of creating a logistic regression model. ",
    "supporting": [
      "blog-post-3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}